var U=Object.defineProperty;var k=(d,l)=>U(d,"name",{value:l,configurable:true});import{c as X}from"./createLazyWrapper-CcCD0Sct.js";import{j as Y}from"./jsx-runtime-CGXnEs--.js";import{r as i}from"./index-Dko9tpwX.js";import{i as w}from"./validations-hwxYw-LN.js";import{F as Z,a as $}from"./Form.stories-CgRU6yJH.js";import"./_commonjsHelpers-DRKe4gOT.js";import"./DatePicker-BX2luGH9.js";import"./iframe-Bi7ppp4I.js";import"../sb-preview/runtime.js";import"./createIsland-D0Kq_01P.js";import"./Input.view-Bzo9O-TZ.js";import"./Label-X7jo9b-B.js";import"./bem-DSWMYwqE.js";import"./Input-SPqw_TY7.js";import"./Select-BBOYFlVj.js";import"./Slider-BPVHYHyn.js";import"./Switch-CG6tVRGn.js";import"./Icon-DGKrsoYY.js";import"./GridRow-HZejGWQd.js";import"./List-DdkFPd3w.js";import"./Card-Dk-rt7g8.js";import"./Animated-BdM8DBhp.js";import"./Skeleton-DZFb9hKt.js";import"./Image-r6ezNYoV.js";import"./Link-Fk19pIsw.js";import"./Link.server-Dprb4yLH.js";import"./BaseLink.server-CO1n6jUB.js";import"./Button-D4YSYZ_9.js";import"./Headline-rrg3Yjxm.js";import"./AnimatedText-eYhSD-r2.js";function g(d,l){return{...d,...l}}k(g,"mergeField");const ee=k(d=>{const l=i.useRef(null);i.useEffect(()=>{if(l.current&&d){const h=l.current;l.current=null;d(h)}});return h=>{l.current=h}},"useDeferredNotifier");const H=i.memo(d=>{const{disabled:l,fields:h,defaultFields:M,messages:S,onSubmit:A,onChangeForm:j,messagesFields:q,hideResponse:N,...D}=d;const[m,P]=i.useState(()=>h??[]);const[R,_]=i.useState(S);const[O,z]=i.useState("");const v=ee(j);i.useEffect(()=>{if(S!==void 0){_(S)}},[S]);const E=i.useCallback((e,n)=>{P(c=>{const t=[...c];const s={...t[e],...n};t[e]=s;v(s);return t})},[v]);const L=i.useCallback((e,n)=>{if(e.errorText===n){return}const c=m.findIndex(t=>(t==null?void 0:t.name)===(e==null?void 0:e.name));if(c<0)return;E(c,{errorText:n});_(t=>{const s={...(t==null?void 0:t.errors)??{}};if(w(n)){s[e.name??e.label??""]=[n]}else{delete s[e.name??e.label??""]}return{errors:Object.keys(s).length>0?s:void 0}})},[m,E]);const W=i.useCallback((e,n)=>{P(c=>{const t=[...c];const s=t.findIndex(r=>r.name===e.name);if(s<0)return c;if(e.fieldType==="dynamic-list"){const r=t[s];const a=g(r,{value:n});t[s]=a;v(a);return t}const I=k((r,a)=>{const y=a===void 0||a==="";const o=Array.isArray(a)&&a.length===0;if(y||o)return false;if(typeof r==="boolean")return r===a;if(typeof r==="string"||typeof r==="number"){return r===a}if(Array.isArray(r)){if(typeof a==="string"||typeof a==="number"){return r.includes(a)}if(Array.isArray(a)){const u=a;const f=r;return u.some(V=>f.includes(V))}}return false},"matches");const b=new Map;for(const r of M??[]){if(w(r==null?void 0:r.name))b.set(r.name,r)}const F=Array.isArray(e.conditions)?e.conditions:[];const x=Array.from(new Set(F.map(r=>r.fieldId).filter(Boolean)));for(const r of x){const a=t.findIndex(Q=>Q.name===r);if(a<0)continue;const y=t[a];const o=b.get(r);const u=o?{...o}:{visible:false};delete u.value;delete u.errorText;let f=g(y,u);const V=o&&typeof o.visible==="boolean"?o.visible:false;if(V===false){f=g(f,{value:void 0,errorText:void 0})}t[a]=f}const p=new Set;for(const r of F){const a=t.findIndex(o=>o.name===r.fieldId);if(a<0)continue;const y=typeof r.equalTo==="undefined"?true:I(r.equalTo,n);if(y){const o=t[a];const u=r.updateProps??{};t[a]=g(o,u);p.add(o.name??"")}}for(const r of x){if(p.has(r))continue;const a=t.findIndex(V=>V.name===r);if(a<0)continue;const y=t[a];const o=b.get(r);const u=o&&typeof o.visible==="boolean"?o.visible:false;let f=g(y,{visible:u});if(u===false){f=g(f,{value:void 0,errorText:void 0})}t[a]=f}const C=t[s];const B=g(C,{value:n});t[s]=B;v(B);return t})},[M,v]);const G=i.useCallback(e=>{z(e.target.value)},[]);const T=i.useCallback(()=>{const e={};m.forEach(n=>{var I,b,F,x;const c=n.visible!==false;const t=Array.isArray(n.value)&&n.value.length===0;const s=n.value===void 0||n.value==="";if(Boolean(n.required)&&c&&(s||t)){const p=((b=(I=q==null?void 0:q.errors)==null?void 0:I.input)==null?void 0:b["required"])??"This field is required";const C=n.name??n.label??"";if(!e[C]){e[C]=[]}(F=e[C])==null?void 0:F.push(p)}if(w(n.errorText)){const p=n.name??n.label??"";if(!e[p]){e[p]=[]}(x=e[p])==null?void 0:x.push(n.errorText)}});return{errors:Object.keys(e).length>0?e:void 0}},[m,q]);const J=i.useCallback(e=>{e.preventDefault();const{errors:n}=T();_({errors:n});if(!n){A==null?void 0:A(m)}},[m,A,T]);const K=i.useMemo(()=>{if(Boolean(N)){return m.every(e=>{if(!Boolean(e.required)||e.visible===false)return true;if(Array.isArray(e.value))return e.value.length>0;return e.value!==void 0&&e.value!==""})}return true},[m,N]);return Y.jsx(Z,{...D,disabled:l,formMessages:R,formState:m,isFormValid:K,isHoneypotEmpty:O.length===0,fieldProps:{onChange:W,onValidate:L},honeypot:{defaultValue:"",onChange:G,autoComplete:"off"},onFormSubmit:J})});H.displayName="FormClient";try{H.displayName="FormClient";H.__docgenInfo={"description":"","displayName":"FormClient","props":{"label":{"defaultValue":null,"description":"Form title/label (used in headline).","name":"label","required":true,"type":{"name":"string"}},"disabled":{"defaultValue":null,"description":"Disable all form fields.","name":"disabled","required":false,"type":{"name":"boolean"}},"variant":{"defaultValue":null,"description":"Color variant for theme.","name":"variant","required":false,"type":{"name":"enum","value":[{"value":'"inherit"'},{"value":'"primary"'},{"value":'"secondary"'},{"value":'"success"'},{"value":'"error"'},{"value":'"info"'},{"value":'"warning"'}]}},"hideResponse":{"defaultValue":null,"description":"Hide success/error message after submission.","name":"hideResponse","required":false,"type":{"name":"boolean"}},"fields":{"defaultValue":null,"description":"Array of fields to render.","name":"fields","required":false,"type":{"name":"FormField[]"}},"hideHeadline":{"defaultValue":null,"description":"Hide the form title headline.","name":"hideHeadline","required":false,"type":{"name":"boolean"}},"headlineProps":{"defaultValue":null,"description":"Props forwarded to headline element.","name":"headlineProps","required":false,"type":{"name":"HeadlineProps"}},"defaultFields":{"defaultValue":null,"description":"Default field values (fallback if fields not provided).","name":"defaultFields","required":false,"type":{"name":"FormField[]"}},"messages":{"defaultValue":null,"description":"Form-level success/error messages.","name":"messages","required":false,"type":{"name":"FormMessages"}},"messagesFields":{"defaultValue":null,"description":"Field-level error translations.","name":"messagesFields","required":false,"type":{"name":"FormFieldMessages"}},"button":{"defaultValue":null,"description":"Submit button config (overrides defaults).","name":"button","required":false,"type":{"name":"FormButton"}},"onSubmit":{"defaultValue":null,"description":"Called on form submission with validated fields.","name":"onSubmit","required":false,"type":{"name":"((fields: FormField[]) => void)"}},"onChangeForm":{"defaultValue":null,"description":"Called whenever any field changes.","name":"onChangeForm","required":false,"type":{"name":"OnChangeFormHandler"}}}}}catch(d){}const Me=X({name:"Form",Client:H,Server:$});export{Me as default};
