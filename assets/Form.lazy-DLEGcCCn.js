var U=Object.defineProperty;var k=(d,l)=>U(d,"name",{value:l,configurable:true});import{c as X}from"./createLazyWrapper-AC75M60Y.js";import{j as Y}from"./jsx-runtime-CGXnEs--.js";import{r as i}from"./index-DGnhqvo7.js";import{a as N}from"./validations-DJC0TP_C.js";import{F as Z,a as $}from"./Form.stories-ChUbiOO3.js";import"./_commonjsHelpers-DRKe4gOT.js";import"./DatePicker-CIo3BEom.js";import"./iframe-DURURz1S.js";import"../sb-preview/runtime.js";import"./createIsland-fzL0F2Ul.js";import"./Input.view-Dtygztdk.js";import"./Label-BmAeSxLe.js";import"./bem-DSWMYwqE.js";import"./Input-nORsiYwC.js";import"./Select-B5kJH9fO.js";import"./Slider-CvknVyzL.js";import"./Switch-XwUJyruO.js";import"./Icon-CYZaZrms.js";import"./GridRow-Dn8DBMT2.js";import"./List-DqfaO5DP.js";import"./Card-DxPDuqz-.js";import"./Animated-bpCjxed0.js";import"./Skeleton-D1l49Oz-.js";import"./Image-Ck26wVcw.js";import"./Link-BgQ9W8ME.js";import"./Link.server-BZ5NjJWg.js";import"./BaseLink.server-BRG_yKpR.js";import"./Button-Dx_ZeocV.js";import"./Headline-3f-aiLjr.js";import"./AnimatedText-DVcufcix.js";function g(d,l){return{...d,...l}}k(g,"mergeField");const ee=k(d=>{const l=i.useRef(null);i.useEffect(()=>{if(l.current&&d){const h=l.current;l.current=null;d(h)}});return h=>{l.current=h}},"useDeferredNotifier");const _=i.memo(d=>{const{disabled:l,fields:h,defaultFields:E,messages:S,onSubmit:A,onChangeForm:w,messagesFields:q,hideResponse:H,...R}=d;const[m,P]=i.useState(()=>h??[]);const[D,M]=i.useState(S);const[O,z]=i.useState("");const F=ee(w);i.useEffect(()=>{if(S!==void 0){M(S)}},[S]);const T=i.useCallback((e,n)=>{P(c=>{const t=[...c];const s={...t[e],...n};t[e]=s;F(s);return t})},[F]);const L=i.useCallback((e,n)=>{if(e.errorText===n){return}const c=m.findIndex(t=>(t==null?void 0:t.name)===(e==null?void 0:e.name));if(c<0)return;T(c,{errorText:n});M(t=>{const s={...(t==null?void 0:t.errors)??{}};if(N(n)){s[e.name??e.label??""]=[n]}else{delete s[e.name??e.label??""]}return{errors:Object.keys(s).length>0?s:void 0}})},[m,T]);const W=i.useCallback((e,n)=>{P(c=>{const t=[...c];const s=t.findIndex(r=>r.name===e.name);if(s<0)return c;if(e.fieldType==="dynamic-list"){const r=t[s];const a=g(r,{value:n});t[s]=a;F(a);return t}const I=k((r,a)=>{const y=a===void 0||a==="";const o=Array.isArray(a)&&a.length===0;if(y||o)return false;if(typeof r==="boolean")return r===a;if(typeof r==="string"||typeof r==="number"){return r===a}if(Array.isArray(r)){if(typeof a==="string"||typeof a==="number"){return r.includes(a)}if(Array.isArray(a)){const u=a;const p=r;return u.some(C=>p.includes(C))}}return false},"matches");const b=new Map;for(const r of E??[]){if(N(r==null?void 0:r.name))b.set(r.name,r)}const v=Array.isArray(e.conditions)?e.conditions:[];const x=Array.from(new Set(v.map(r=>r.fieldId).filter(Boolean)));for(const r of x){const a=t.findIndex(Q=>Q.name===r);if(a<0)continue;const y=t[a];const o=b.get(r);const u=o?{...o}:{visible:false};delete u.value;delete u.errorText;let p=g(y,u);const C=o&&typeof o.visible==="boolean"?o.visible:false;if(C===false){p=g(p,{value:void 0,errorText:void 0})}t[a]=p}const f=new Set;for(const r of v){const a=t.findIndex(o=>o.name===r.fieldId);if(a<0)continue;const y=typeof r.equalTo==="undefined"?true:I(r.equalTo,n);if(y){const o=t[a];const u=r.updateProps??{};t[a]=g(o,u);f.add(o.name??"")}}for(const r of x){if(f.has(r))continue;const a=t.findIndex(C=>C.name===r);if(a<0)continue;const y=t[a];const o=b.get(r);const u=o&&typeof o.visible==="boolean"?o.visible:false;let p=g(y,{visible:u});if(u===false){p=g(p,{value:void 0,errorText:void 0})}t[a]=p}const V=t[s];const j=g(V,{value:n});t[s]=j;F(j);return t})},[E,F]);const G=i.useCallback(e=>{z(e.target.value)},[]);const B=i.useCallback(()=>{const e={};m.forEach(n=>{var I,b,v,x;const c=n.visible!==false;const t=Array.isArray(n.value)&&n.value.length===0;const s=n.value===void 0||n.value==="";if(Boolean(n.required)&&c&&(s||t)){const f=((b=(I=q==null?void 0:q.errors)==null?void 0:I.input)==null?void 0:b["required"])??"This field is required";const V=n.name??n.label??"";if(!e[V]){e[V]=[]}(v=e[V])==null?void 0:v.push(f)}if(N(n.errorText)){const f=n.name??n.label??"";if(!e[f]){e[f]=[]}(x=e[f])==null?void 0:x.push(n.errorText)}});return{errors:Object.keys(e).length>0?e:void 0}},[m,q]);const J=i.useCallback(e=>{e.preventDefault();const{errors:n}=B();M({errors:n});if(!n){A==null?void 0:A(m)}},[m,A,B]);const K=i.useMemo(()=>{if(Boolean(H)){return m.every(e=>{if(!Boolean(e.required)||e.visible===false)return true;if(Array.isArray(e.value))return e.value.length>0;return e.value!==void 0&&e.value!==""})}return true},[m,H]);return Y.jsx(Z,{...R,disabled:l,formMessages:D,formState:m,isFormValid:K,isHoneypotEmpty:O.length===0,fieldProps:{onChange:W,onValidate:L},honeypot:{defaultValue:"",onChange:G,autoComplete:"off"},onFormSubmit:J})});_.displayName="FormClient";try{_.displayName="FormClient";_.__docgenInfo={"description":"","displayName":"FormClient","props":{"label":{"defaultValue":null,"description":"","name":"label","required":true,"type":{"name":"string"}},"disabled":{"defaultValue":null,"description":"","name":"disabled","required":false,"type":{"name":"boolean"}},"variant":{"defaultValue":null,"description":"","name":"variant","required":false,"type":{"name":"enum","value":[{"value":'"inherit"'},{"value":'"primary"'},{"value":'"secondary"'},{"value":'"success"'},{"value":'"error"'},{"value":'"info"'},{"value":'"warning"'}]}},"hideResponse":{"defaultValue":null,"description":"","name":"hideResponse","required":false,"type":{"name":"boolean"}},"fields":{"defaultValue":null,"description":"","name":"fields","required":false,"type":{"name":"FormField[]"}},"hideHeadline":{"defaultValue":null,"description":"","name":"hideHeadline","required":false,"type":{"name":"boolean"}},"headlineProps":{"defaultValue":null,"description":"","name":"headlineProps","required":false,"type":{"name":"HeadlineProps"}},"defaultFields":{"defaultValue":null,"description":"","name":"defaultFields","required":false,"type":{"name":"FormField[]"}},"messages":{"defaultValue":null,"description":"","name":"messages","required":false,"type":{"name":"FormMessages"}},"messagesFields":{"defaultValue":null,"description":"","name":"messagesFields","required":false,"type":{"name":"FormFieldMessages"}},"button":{"defaultValue":null,"description":"","name":"button","required":false,"type":{"name":"FormButton"}},"onSubmit":{"defaultValue":null,"description":"","name":"onSubmit","required":false,"type":{"name":"((fields: FormField[]) => void)"}},"onChangeForm":{"defaultValue":null,"description":"","name":"onChangeForm","required":false,"type":{"name":"OnChangeFormHandler"}}}}}catch(d){}const Ee=X({name:"Form",Client:_,Server:$});export{Ee as default};
